<div>
  <div class="header">
    <div class="filter">
      <mat-form-field appearance="outline" style="width: 100%">
        <mat-label>Search for students or tutors...</mat-label>
        <input
          matInput
          (keyup)="applyFilter($event)"
          placeholder="Search for students or tutors..."
        />
      </mat-form-field>
    </div>
  </div>
  <table mat-table [dataSource]="dataSource" matSort (matSortChange)="sortTableData($event)" class="f-table">
    <!-- Icon Column -->
    <ng-container matColumnDef="icon" sticky>
      <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
      <td mat-cell *matCellDef="let project" (click)="viewStudent(project)">
        <user-icon [size]="30" [user]="project.student"></user-icon>
      </td>
    </ng-container>

    <!-- Username Column -->
    <ng-container matColumnDef="username" sticky>
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Username</th>
      <td mat-cell *matCellDef="let project" (click)="viewStudent(project)">
        {{ project.student.username }}
      </td>
    </ng-container>

    <!-- name Column -->
    <ng-container matColumnDef="name" sticky>
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Name</th>
      <td mat-cell *matCellDef="let project" (click)="viewStudent(project)">
        {{ project.student.name }}
      </td>
    </ng-container>

    <!-- Stats Column -->
    <ng-container matColumnDef="stats" sticky>
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Stats</th>
      <td mat-cell *matCellDef="let project" (click)="viewStudent(project)">
        <div class="f-progress">
          <div
            *ngFor="let bar of project.taskStats"
            [class]="'progress-bar-' + statusClass(bar.key)"
            role="progressbar"
            [style]="{width: bar.value + '%'}"
            [aria-valuenow]="bar.value"
            aria-valuemin="0"
            aria-valuemax="100"
          >
            <span [hidden]="bar.value < 10">{{
              bar.value !== bar.value ? 'No Interaction' : bar.value + '%'
            }}</span>
          </div>
        </div>
      </td>
    </ng-container>

    <!-- flags Column -->
    <ng-container matColumnDef="flags" sticky>
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Flags</th>
      <td mat-cell *matCellDef="let project" (click)="viewStudent(project)">
        <span class="flags">
          <span class="flag">
            <span class="grade-icon">
              <span class="grade-icon" [class]="gradeClass(project.targetGrade)">
                {{ gradeLetter(project.targetGrade) }}
              </span>
            </span>
          </span>
          <span [hidden]="!project.similarityFlag" class="flag">
            <i class="fa fa-eye fa-2x"></i>
          </span>
          <span [hidden]="!project.hasPortfolio" class="flag">
            <i class="fa fa-book fa-2x" ng-class="{'text-muted': project.compilePortfolio}"></i>
          </span>
        </span>
      </td>
    </ng-container>

    <!-- campus Column -->
    <ng-container matColumnDef="campus">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Campus</th>
      <td mat-cell *matCellDef="let project" class="pt-4">
        <student-campus-select
          [unit]="unit"
          [student]="project"
          [update]="true"
        ></student-campus-select>
      </td>
    </ng-container>

    <!-- Tutorial Column -->
    <ng-container matColumnDef="tutorial">
      <th mat-header-cell *matHeaderCellDef>Tutorial</th>
      <td mat-cell *matCellDef="let project" class="pt-4">
        <student-tutorial-select [unit]="unit" [student]="project"></student-tutorial-select>
      </td>
    </ng-container>

    <!-- Disclaimer column -->
    <ng-container matColumnDef="actions">
      <td mat-footer-cell *matFooterCellDef [colSpan]="columns.length">
        <mat-toolbar style="background: none">
          <mat-toolbar-row style="justify-content: space-between">
            <mat-paginator
              class="mat-elevation-z0"
              [pageSizeOptions]="[5, 10, 25, 100]"
            ></mat-paginator>
            <span class="spacer"></span>
            <div>
            <button mat-button target="_blank" (click)="downloadEnrolments()">
              <i class="fa fa-download"></i> Export CSV
            </button>
            <span class="spacer"></span>
          <button mat-button target="_blank" (click)="enrolStudent()">
              <i class="fa fa-user"></i> Enrol Student
            </button>
          </div>
        </mat-toolbar-row>
        </mat-toolbar>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="columns"></tr>
    <tr mat-row *matRowDef="let row; columns: columns" class="table-row"></tr>
    <tr mat-footer-row *matFooterRowDef="['actions']" style="border-top: 1px solid #dddddd"></tr>
  </table>
</div>
